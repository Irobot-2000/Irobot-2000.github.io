import{d as g,e as w}from"./index-DIP_7Pq0.js";import"https://cdnjs.cloudflare.com/ajax/libs/simple-peer/9.11.1/simplepeer.min.js";var{WritableStream:_,TransformStream:m,DOMException:b,Blob:y}=g,{GONE:P}=w,E=/constructor/i.test(window.HTMLElement),C=class{constructor(e="unkown"){this.name=e,this.kind="file"}async getFile(){throw new b(...P)}async isSameEntry(e){return this===e}async createWritable(e={}){var t;const s=await((t=navigator.serviceWorker)==null?void 0:t.getRegistration()),o=document.createElement("a"),n=new m,u=n.writable;if(o.download=this.name,E||!s){let a=[];n.readable.pipeTo(new _({write(r){a.push(new y([r]))},close(){const r=new y(a,{type:"application/octet-stream; charset=utf-8"});a=[],o.href=URL.createObjectURL(r),o.click(),setTimeout(()=>URL.revokeObjectURL(o.href),1e4)}}))}else{const{writable:a,readablePort:r}=new S(_),i=encodeURIComponent(this.name).replace(/['()]/g,escape).replace(/\*/g,"%2A"),f={"content-disposition":"attachment; filename*=UTF-8''"+i,"content-type":"application/octet-stream; charset=utf-8",...e.size?{"content-length":e.size}:{}},R=setTimeout(()=>s.active.postMessage(0),1e4);n.readable.pipeThrough(new m({transform(l,d){if(l instanceof Uint8Array)return d.enqueue(l);const v=new Response(l).body.getReader(),h=j=>v.read().then(p=>p.done?0:h(d.enqueue(p.value)));return h()}})).pipeTo(a).finally(()=>{clearInterval(R)}),s.active.postMessage({url:s.scope+i,headers:f,readablePort:r},[r]);const c=document.createElement("iframe");c.hidden=!0,c.src=s.scope+i,document.body.appendChild(c)}return u.getWriter()}},M=0,T=0,L=1,O=1,U=2,k=class{constructor(e){e.onmessage=t=>this._onMessage(t.data),this._port=e,this._resetReady()}start(e){return this._controller=e,this._readyPromise}write(e){const t={type:M,chunk:e};return this._port.postMessage(t,[e.buffer]),this._resetReady(),this._readyPromise}close(){this._port.postMessage({type:U}),this._port.close()}abort(e){this._port.postMessage({type:O,reason:e}),this._port.close()}_onMessage(e){e.type===T&&this._resolveReady(),e.type===L&&this._onError(e.reason)}_onError(e){this._controller.error(e),this._rejectReady(e),this._port.close()}_resetReady(){this._readyPromise=new Promise((e,t)=>{this._readyResolve=e,this._readyReject=t}),this._readyPending=!0}_resolveReady(){this._readyResolve(),this._readyPending=!1}_rejectReady(e){this._readyPending||this._resetReady(),this._readyPromise.catch(()=>{}),this._readyReject(e),this._readyPending=!1}},S=class{constructor(e){const t=new MessageChannel;this.readablePort=t.port1,this.writable=new e(new k(t.port2))}};export{C as FileHandle};
